<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="reserveMovie">

	<delete id="deleteReservation" parameterType="int">
		DELETE FROM RESERVATION
		WHERE RESERVE_ID = #{reserveId}
	</delete>

	<insert id="insertReservation" parameterType="ReserveMovieVO">
		INSERT INTO RESERVATION
			(RESERVE_ID, THEATER_ID, TIME_ID, SEAT_ID, USER_ID)
		VALUES
			(#{reserveId}, #{theaterId}, #{timeId}, #{seatId}, #{memberId})
	</insert>

	<select id="selectReservation" parameterType="int" resultType="ReserveDetailDataVO">
			SELECT RESERVATION.RESERVE_ID AS RESERVE_ID, THEATER.THEATER_NAME AS theaterName,
				   TIMETABLE.START_TIME AS startTime, SEAT.SEAT_NUMBER AS seatNumber,
				   CINEMA.CINEMA_NAME AS cinemaName, MOVIE.MOVIE_NAME AS movieName
			  FROM RESERVATION
		INNER JOIN TIMETABLE
			    ON RESERVATION.TIME_ID = TIMETABLE.TIME_ID
	 	INNER JOIN MOVIE
				ON TIMETABLE.MOVIE_ID = MOVIE.MOVIE_ID
		INNER JOIN THEATER
				ON TIMETABLE.THEATER_ID = THEATER.THEATER_ID
		INNER JOIN CINEMA
				ON CINEMA.CINEMA_ID = THEATER.CINEMA_ID
		INNER JOIN SEAT
				ON THEATER.THEATER_ID = SEAT.THEATER_ID
		     WHERE RESERVATION.RESERVE_ID = #{reserveId} AND RESERVATION.SEAT_ID=SEAT.SEAT_ID;
	</select>

	<select id="selectReservations" parameterType="String" resultType="ReserveDataListVO">
		SELECT RESERVATION.RESERVE_ID AS reserveId, TIMETABLE.START_TIME AS startTime, MOVIE.MOVIE_NAME AS movieName
		FROM RESERVATION
		INNER JOIN TIMETABLE
		ON RESERVATION.TIME_ID = TIMETABLE.TIME_ID
		INNER JOIN MOVIE
		ON TIMETABLE.MOVIE_ID = MOVIE.MOVIE_ID
		WHERE RESERVATION.USER_ID = #{memberId}
	</select>

</mapper>
